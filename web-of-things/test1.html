<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Knowledge Graph</title>
<style>
body {
  margin:0;
  overflow:hidden;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}
.node text {
  font-size:14px;
  cursor:pointer;
  user-select:none;
  fill: #FFC145;  /* changed text color */

}
.link {
  stroke:#fff;
  stroke-width:1;
}
</style>
<script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<script type="module">
import { nodes, edges } from './nodes.js';
console.log(nodes, edges);

// ----- Setup SVG -----
const width = window.innerWidth;
const height = window.innerHeight;
const svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);
  

const g = svg.append("g");

// ----- Force Simulation -----
const simulation = d3.forceSimulation(nodes)
  .force(
    "link",
    d3.forceLink(edges)
      .id(d => d.id)
      .distance(d => {
        const s = d.source.id.length;
        const t = d.target.id.length;
        return 150 + (s + t) * 10; // longer words â†’ longer links
      })
      .strength(0.9)
  )
  .force("charge", d3.forceManyBody().strength(-350))
  .force(
    "collision",
    d3.forceCollide()
      .radius(d => d.id.length * 4 + 20)
  )
  .force("center", d3.forceCenter(width / 2, height / 2));


// ----- Create links -----
const link = g.selectAll(".link")
  .data(edges)
  .enter()
  .append("line")
  .attr("class","link");

// ----- Create nodes (text only) -----
const node = g.selectAll(".node")
  .data(nodes)
  .enter()
  .append("g")
  .attr("class","node")
  .call(d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended)
  );

node.append("text")
  .attr("text-anchor","middle")
  .attr("dy",4)
  .text(d => d.id);

// ----- Tick function -----
simulation.on("tick", ()=>{
  link
    .attr("x1", d=>d.source.x)
    .attr("y1", d=>d.source.y)
    .attr("x2", d=>d.target.x)
    .attr("y2", d=>d.target.y);

  node.attr("transform", d=>`translate(${d.x},${d.y})`);
});

// ----- Drag functions -----
function dragstarted(event,d){
  if(!event.active) simulation.alphaTarget(0.3).restart();
  d.fx=d.x; d.fy=d.y;
}
function dragged(event,d){
  d.fx=event.x; d.fy=event.y;
}
function dragended(event,d){
  if(!event.active) simulation.alphaTarget(0);
  d.fx=null; d.fy=null;
}

// ----- Zoom -----
svg.call(d3.zoom().scaleExtent([0.1,4]).on("zoom", (event)=>{
  g.attr("transform", event.transform);
}));
</script>
</body>
</html>
